<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>æ‰“å°ç¥ˆç¦èµ„æ–™</title>
  <style>
    @page { size: A4; margin: 15mm; }

    body {
      font-family: "Segoe UI", sans-serif;
      margin: auto;
      color: #000;
      max-width: 720px;
      width: 100%;
    }

    .header-block {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 15px;
      margin-bottom: 10px;
    }

    .header-block .logo {
      width: 120px;
      height: auto;
      object-fit: contain;
    }

    .header-center {
      flex: 1;
      text-align: center;
    }

    .header-center h2 {
      margin: 0;
      font-size: 28px;
      color: #000;
      line-height: 1.4;
    }

    .header-line {
      font-size: 13px;
      line-height: 1.4;
      margin: 2px 0;
    }

    .taishui {
      text-align: center;
      font-size: 16px;
      font-weight: bold;
      margin: 5px 0 10px;
    }

    .info {
      margin-top: 12px;
      font-size: 14px;
    }

    .info span {
      display: inline-block;
      margin-right: 20px;
      margin-bottom: 4px;
    }

    .btn-print {
      text-align: right;
      margin: 10px 0 5px;
    }

    .btn-print button {
      padding: 6px 12px;
      font-size: 14px;
      background: #d0021b;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 12px;
      table-layout: fixed;
    }

    th, td {
      border: 1px solid #000;
      padding: 3px 4px;
      text-align: center;
      word-break: break-word;
      white-space: nowrap;
      height: 28px;
      vertical-align: middle;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .footer-wrap {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-top: 20px;
      gap: 20px;
      page-break-inside: avoid;
    }

    .blessing-box {
      flex: 1;
      max-width: 55%;
    }

    .blessing {
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      line-height: 1.6;
    }

    .totals {
      flex-shrink: 0;
      font-size: 14px;
      font-weight: bold;
      line-height: 1.6;
    }

    @media print {
      .btn-print { display: none; }
    }
  </style>
</head>
<body>

<div class="header-block">
  <img src="left-logo.jpg" class="logo" alt="å·¦ Logo">
  <div class="header-center">
    <h2>çœŸä½›å®—è¯—å·«å¦™ç†é›·è—å¯º</h2>
    <div class="header-line">Persatuan Miao Li Tang Sibu</div>
    <div class="header-line">No.22N, Taman Damai, Off Brooke Drive 33,</div>
    <div class="header-line">Jalan Tun Abang Haji Openg, 96000, Sibu, Sarawak, Malaysia.</div>
    <div class="header-line">Tel: 6-084-342986 / 013-980-4461</div>
    <div class="header-line">Fax: 6-084-319961</div>
  </div>
  <img src="right-logo.jpg" class="logo" alt="å³ Logo">
</div>

<div class="taishui">2025 (ä¹™å·³) å¹´ å½“å€¼å¤ªå² å´é‚</div>

<div class="info">
  <span><strong>ä¸»ç¥ˆè€…ï¼š</strong><span id="mainName"></span></span>
  <span><strong>ç”µè¯ï¼š</strong><span id="phoneNumber"></span></span>
  <span><strong>æ”¶æ®ç¼–å·ï¼š</strong><span id="receiptNumber"></span></span>
  <span><strong>æ”¶æ¬¾æ—¥æœŸï¼š</strong><span id="receiptDate"></span></span>
</div>

<div class="btn-print">
  <button onclick="window.print()">ğŸ–¨ï¸ æ‰“å°è¡¨å•</button>
</div>

<table>
  <thead>
    <tr>
      <th style="width:20%">ç¥ˆç¦è€…</th>
      <th style="width:7%">å¤ªå²</th><th style="width:5%">çº¸é‡‘</th>
      <th style="width:7%">å…‰æ˜<br/>ç¯</th><th style="width:5%">çº¸é‡‘</th>
      <th style="width:7%">é•¿ç”Ÿ<br/>ç¦„ä½</th><th style="width:5%">çº¸é‡‘</th>
      <th style="width:7%">æ–‡æ˜Œ<br/>å¸å›</th><th style="width:5%">çº¸é‡‘</th>
      <th style="width:7%">åå…­<br/>ç½—æ±‰</th><th style="width:5%">çº¸é‡‘</th>
      <th style="width:10%">å®‰å¥‰<br/>åŠŸå¾·é‡‘</th>
    </tr>
  </thead>
  <tbody id="prayerBody"></tbody>
</table>

<div class="footer-wrap">
  <div class="blessing-box">
    <div class="blessing">
      å¸ˆå°Šï¼Œä½›è©è¨åŠ æŒç¾å„åŒ–è§£ï¼Œ<br/>
      é€¢å…‡åŒ–å‰ï¼Œä¸‡äº‹éƒ½å¦‚æ„ã€‚
    </div>
  </div>
  <div class="totals" id="totalBox"></div>
</div>

<script>
  window.addEventListener("message", function (event) {
    let data;
    try {
      data = JSON.parse(event.data);
    } catch {
      alert("âŒ æ— æ•ˆæ•°æ®æ ¼å¼");
      return;
    }

    document.getElementById("mainName").textContent = data.mainName || "";
    document.getElementById("phoneNumber").textContent = data.phoneNumber || "";
    document.getElementById("receiptNumber").textContent = data.receiptNumber || "";
    document.getElementById("receiptDate").textContent = data.receiptDate || "";

    const tbody = document.getElementById("prayerBody");
    tbody.innerHTML = "";

    let sum = { pg1: 0, pg2: 0, pg3: 0, pg4: 0, pg5: 0, donation: 0, wishPaper: 0 };
    const num = val => parseFloat(val || 0);
    const showCheck = val => val === "æ˜¯" ? "âœ”" : "";

    for (let i = 0; i < 15; i++) {
      const p = (data.data || [])[i] || {};
      sum.pg1 += num(p.paperGold1);
      sum.pg2 += num(p.paperGold2);
      sum.pg3 += num(p.paperGold3);
      sum.pg4 += num(p.paperGold4);
      sum.pg5 += num(p.paperGold5);
      sum.donation += num(p.donation);

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${p.name || ""}</td>
        <td>${showCheck(p.taiSui)}</td><td>${p.paperGold1 || ""}</td>
        <td>${showCheck(p.light)}</td><td>${p.paperGold2 || ""}</td>
        <td>${showCheck(p.longevity)}</td><td>${p.paperGold3 || ""}</td>
        <td>${showCheck(p.wisdom)}</td><td>${p.paperGold4 || ""}</td>
        <td>${showCheck(p.arhat)}</td><td>${p.paperGold5 || ""}</td>
        <td>${p.donation || ""}</td>
      `;
      tbody.appendChild(row);
    }

    sum.wishPaper = num(data.wishPaper);
    const paperTotal = sum.pg1 + sum.pg2 + sum.pg3 + sum.pg4 + sum.pg5 + sum.wishPaper;
    const paperMoney = paperTotal * 3;
    const total = paperMoney + sum.donation;

document.getElementById("totalBox").innerHTML = `
  <table style="font-size: 1rem; border-collapse: collapse;">
    <tr>
      <td style="white-space: nowrap;">çœŸä½›åå››å®é‡‘ï¼š</td>
      <td style="white-space: nowrap;">3.00 x ${paperTotal} ä»½ =</td>
      <td style="text-align: right;">RM ${paperMoney.toFixed(2)}</td>
    </tr>
    <tr>
      <td colspan="3" style="color: #888; font-size: 0.95em;">ï¼ˆå«è¿˜æ„¿çº¸é‡‘ï¼‰</td>
    </tr>
    <tr>
      <td style="white-space: nowrap;">å®‰å¥‰åŠŸå¾·é‡‘ï¼š</td>
      <td></td>
      <td style="text-align: right;">RM ${sum.donation.toFixed(2)}</td>
    </tr>
    <tr>
      <td style="white-space: nowrap;">æ€»è®¡ï¼š</td>
      <td></td>
      <td style="text-align: right;"><strong>RM ${total.toFixed(2)}</strong></td>
    </tr>
  </table>
`;



  });
</script>

</body>
</html>
