<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç¥–å…ˆè¶…åº¦å ±åè¡¨</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      padding: 20px;
      background: #fffbe9;
      color: #333;
    }
    h1 {
      text-align: center;
      font-size: 24px;
      margin-bottom: 10px;
    }
    .ancestor-group {
      border: 2px dashed #aaa;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 20px;
      background: #fff;
    }
    label {
      display: block;
      margin-top: 8px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 6px 10px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .flex-row {
      display: flex;
      gap: 10px;
    }
    .flex-row > div {
      flex: 1;
    }
    button {
      padding: 10px 20px;
      background: #ffd369;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      margin: 10px 5px 0 0;
      cursor: pointer;
    }
    button:hover {
      background: #fcbf49;
    }
    .total {
      margin-top: 10px;
      font-weight: bold;
      color: #c92c2c;
    }
  </style>
</head>
<body>
  <h1>ç¥–å…ˆè¶…åº¦å ±åè¡¨</h1>
  <div id="ancestorList"></div>

  <button onclick="addAncestor()">â• æ–°å¢ä¸€ä½ç¥–å…ˆ</button>
  <button onclick="previewData()">ğŸ“‹ é è¦½è³‡æ–™</button>

  <div class="total" id="amountDisplay">æœ¬é åˆè¨ˆï¼š0 å…ƒ</div>

  <script>
    let ancestorData = [];

    const ITEM_PRICES = {
      token: 5,
      boat: 30,
      lotus: 6,
      paper3: 3,
      paper6: 6,
      paper27: 27
    };

    function createAncestorForm(index) {
      const ancestor = ancestorData[index];
      const container = document.createElement('div');
      container.className = 'ancestor-group';
      container.innerHTML = `
        <label>ç¥–å…ˆ/äº¡éˆ å§“åï¼š</label>
        <input type="text" value="${ancestor.name || ''}" oninput="ancestorData[${index}].name = this.value; updateAmount();"/>

        <label>å®‰å¥‰åœ°é»ï¼š</label>
        <select onchange="ancestorData[${index}].placeType = this.value; renderAncestorList();">
          <option value="">-- è«‹é¸æ“‡åœ°é»é¡å‹ --</option>
          <option value="åœ°è—æ®¿ç‰Œä½" ${ancestor.placeType === 'åœ°è—æ®¿ç‰Œä½' ? 'selected' : ''}>åœ°è—æ®¿ç‰Œä½</option>
          <option value="éˆéª¨æ®¿ç¦ä½" ${ancestor.placeType === 'éˆéª¨æ®¿ç¦ä½' ? 'selected' : ''}>éˆéª¨æ®¿ç¦ä½</option>
          <option value="å¢“åœ’" ${ancestor.placeType === 'å¢“åœ’' ? 'selected' : ''}>å¢“åœ’</option>
          <option value="ç‰Œä½" ${ancestor.placeType === 'ç‰Œä½' ? 'selected' : ''}>ç‰Œä½</option>
        </select>

        ${ancestor.placeType ? `
        <label>${ancestor.placeType}ï¼š</label>
        <input type="text" value="${ancestor.placeName || ''}" oninput="ancestorData[${index}].placeName = this.value;"/>` : ''}

        <div class="flex-row">
          <div><label>ä»¤ç‰Œ</label><input type="number" min="0" value="${ancestor.token || ''}" oninput="ancestorData[${index}].token = this.value; updateAmount();"/></div>
          <div><label>é…å¥—</label><input type="number" min="0" value="${ancestor.boat || ''}" oninput="ancestorData[${index}].boat = this.value; updateAmount();"/></div>
          <div><label>è“®èŠ±</label><input type="number" min="0" value="${ancestor.lotus || ''}" oninput="ancestorData[${index}].lotus = this.value; updateAmount();"/></div>
        </div>
        <div class="flex-row">
          <div><label>ç´™é‡‘3</label><input type="number" min="0" value="${ancestor.paper3 || ''}" oninput="ancestorData[${index}].paper3 = this.value; updateAmount();"/></div>
          <div><label>ç´™é‡‘6</label><input type="number" min="0" value="${ancestor.paper6 || ''}" oninput="ancestorData[${index}].paper6 = this.value; updateAmount();"/></div>
          <div><label>ç´™é‡‘27</label><input type="number" min="0" value="${ancestor.paper27 || ''}" oninput="ancestorData[${index}].paper27 = this.value; updateAmount();"/></div>
        </div>

        ${index > 0 ? `<button onclick="removeAncestor(${index})">âŒ åˆªé™¤æ­¤ç­†</button>` : ''}
      `;
      return container;
    }

    function renderAncestorList() {
      const list = document.getElementById('ancestorList');
      list.innerHTML = '';
      ancestorData.forEach((_, index) => {
        list.appendChild(createAncestorForm(index));
      });
      updateAmount();
    }

    function addAncestor() {
      if (ancestorData.length >= 8) return alert("æœ€å¤šåªèƒ½å¡«å¯« 8 ä½ç¥–å…ˆï¼");
      ancestorData.push({});
      renderAncestorList();
    }

    function removeAncestor(index) {
      ancestorData.splice(index, 1);
      renderAncestorList();
    }

    function updateAmount() {
      const currentPageIndex = ancestorData.length - 1;
      const amounts = ancestorData.map(data => {
        return (parseInt(data.token) || 0) * ITEM_PRICES.token +
               (parseInt(data.boat) || 0) * ITEM_PRICES.boat +
               (parseInt(data.lotus) || 0) * ITEM_PRICES.lotus +
               (parseInt(data.paper3) || 0) * ITEM_PRICES.paper3 +
               (parseInt(data.paper6) || 0) * ITEM_PRICES.paper6 +
               (parseInt(data.paper27) || 0) * ITEM_PRICES.paper27;
      });
      const currentAmount = amounts[currentPageIndex] || 0;
      const totalAmount = amounts.reduce((a, b) => a + b, 0);
      document.getElementById('amountDisplay').innerText =
        ancestorData.length <= 1
          ? `æœ¬é åˆè¨ˆï¼š${currentAmount} å…ƒ`
          : `ç›®å‰ç¸½é‡‘é¡ï¼š${totalAmount} å…ƒ`;
    }

    function previewData() {
      let preview = ancestorData.map((data, i) =>
        `ç¬¬ ${i + 1} ä½ç¥–å…ˆï¼š${data.name || 'æœªå¡«'}\n` +
        `åœ°é»ï¼š${data.placeType || ''} - ${data.placeName || ''}\n` +
        `é‡‘é¡ï¼š${calculateSingleAmount(data)} å…ƒ`
      ).join('\n\n');
      const total = ancestorData.reduce((sum, d) => sum + calculateSingleAmount(d), 0);
      alert(preview + `\n\nç¸½é‡‘é¡ï¼š${total} å…ƒ`);
    }

    function calculateSingleAmount(data) {
      return (parseInt(data.token) || 0) * ITEM_PRICES.token +
             (parseInt(data.boat) || 0) * ITEM_PRICES.boat +
             (parseInt(data.lotus) || 0) * ITEM_PRICES.lotus +
             (parseInt(data.paper3) || 0) * ITEM_PRICES.paper3 +
             (parseInt(data.paper6) || 0) * ITEM_PRICES.paper6 +
             (parseInt(data.paper27) || 0) * ITEM_PRICES.paper27;
    }

    // åˆå§‹åŒ–é¡¯ç¤ºç¬¬ä¸€ä½
    ancestorData.push({});
    renderAncestorList();
  </script>
</body>
</html>
